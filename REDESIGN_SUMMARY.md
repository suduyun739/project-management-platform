# 项目重构需求汇总与进度报告

## 📋 完整需求清单（来自用户）

### 1. 项目页面优化 ✅
**状态**: ✅ 已完成（第一阶段）

**需求**:
- ✅ 添加"开始日期"列
- ✅ 添加"结束日期"列
- ✅ 状态列改为行内下拉选择框（无需打开对话框）
- ✅ 开始/结束日期支持行内日期选择器
- ✅ 修改后自动保存到后端
- ✅ 修复进度计算（需求进度和任务进度分开显示）
- 🔲 实现项目拖拽排序（sortablejs已添加，未实现UI）
- ✅ 确保"项目"链接能跳转到对应筛选页面

**已实现功能**:
- 所有列支持行内编辑，实时自动保存
- 修改失败时自动恢复原值
- 右上角显示成功/失败提示

---

### 2. 需求页面重构 🔲
**状态**: 🔲 待开始（第二阶段）

**核心需求**:
- 🔲 需求页面与项目页面合并为树形结构
  - 项目作为一级节点
  - 需求作为二级节点
  - 子需求作为三级节点
- 🔲 支持多选负责人（下拉多选框）
- 🔲 添加子需求功能
- 🔲 所有列（除标题外）支持行内编辑
- 🔲 支持拖拽调整项目排序
- 🔲 遵循项目列表的排序顺序
- 🔲 默认展开树形结构

**技术要点**:
- 使用 Element Plus Tree Table 组件
- 实现懒加载或一次性加载
- 处理父子关系的级联操作
- 多选负责人的UI和数据绑定

---

### 3. 任务页面重构 🔲
**状态**: 🔲 待开始（第三阶段）

**核心需求**:
- ✅ 修复任务表单：startDate/dueDate 为空时的验证错误（已修复）
- 🔲 所有列支持行内编辑
- 🔲 支持多选负责人
- 🔲 添加子任务功能
- 🔲 按项目分组显示
  - 需求作为一级标题
  - 任务嵌套在需求下
  - 子任务再嵌套一层
- 🔲 默认显示第一个项目的任务
- 🔲 默认展开树形结构

**布局结构**:
```
项目筛选器
├─ 需求A
│  ├─ 任务1
│  │  └─ 子任务1-1
│  └─ 任务2
├─ 需求B
│  └─ 任务3
└─ 无需求任务
   └─ 任务4
```

---

### 4. 看板与数据看板优化 🔲
**状态**: 🔲 待开始（第四阶段）

**核心需求**:
- 🔲 删除 `Kanban.vue` 文件
- 🔲 优化 Dashboard 数据看板
  - 默认显示第一个项目的数据
  - 优化数据可视化展示
  - 添加项目切换功能

---

### 5. 用户管理优化 ✅
**状态**: ✅ 已完成

**需求**:
- ✅ 删除邮箱字段（用户表单和列表）

---

## 🎯 已完成工作（第一阶段）

### 后端API优化
- ✅ 扩展数据库Schema支持多对多关系
  - 添加 `RequirementAssignee` 关联表
  - 添加 `TaskAssignee` 关联表
  - 添加 `Project.sortOrder` 字段
- ✅ 更新 Requirements API 支持 `assigneeIds` 数组
- ✅ 更新 Tasks API 支持 `assigneeIds` 数组
- ✅ 添加 `/api/projects/reorder` 批量排序端点
- ✅ 数据迁移脚本（自动迁移现有单一负责人数据）

### 前端优化
- ✅ Projects.vue 行内编辑（状态、开始日期、结束日期）
- ✅ 修复 Tasks.vue 表单验证错误
- ✅ 删除 Users.vue 邮箱字段
- ✅ 更新 TypeScript 类型定义（assignees, assigneeIds, sortOrder）
- ✅ 添加 sortablejs 依赖

### Bug修复
- ✅ 修复空日期字段导致的验证错误
- ✅ 移除 form-item 的 `prop` 属性以避免非必填字段验证

### 部署优化
- ✅ 创建详细的部署文档（STAGE1_COMPLETE.md）
- ✅ 创建问题排查指南（DEPLOY_TROUBLESHOOTING.md）
- ✅ 优化 Dockerfile npm 网络配置
- ✅ 解决镜像源问题（回退到官方源）

---

## 📊 整体进度

### 进度概览
- ✅ **第一阶段**: 100% 完成
  - 后端多负责人API支持
  - 项目页面基础优化（行内编辑）
  - Bug修复和部署优化

- 🔲 **第二阶段**: 0% 开始
  - 需求页面树形结构重构
  - 多选负责人功能
  - 子需求功能

- 🔲 **第三阶段**: 0% 开始
  - 任务页面树形结构重构
  - 多选负责人功能
  - 子任务功能

- 🔲 **第四阶段**: 0% 开始
  - 删除 Kanban
  - 优化 Dashboard

### 总体进度: **25%**
- 4个阶段中完成了1个
- 核心后端API支持已就绪
- 剩余工作主要是前端UI重构

---

## 🚀 下一步计划

### 立即任务
1. **确保第一阶段成功部署**
   - 解决当前的 Docker 构建问题
   - 验证数据库迁移正确执行
   - 测试行内编辑功能

2. **第二阶段准备**（预计3-4小时）
   - 设计需求页面树形结构组件
   - 实现多选负责人下拉框
   - 处理子需求的创建和显示

### 技术挑战
1. **树形表格性能优化** - 大量数据时的渲染性能
2. **行内编辑与树形结构结合** - 复杂的交互逻辑
3. **多选负责人的数据同步** - 前后端数据一致性
4. **拖拽排序的实现** - sortablejs 与 Vue 3 的集成

---

## 💡 技术栈

**后端**:
- Node.js + Express
- Prisma ORM
- PostgreSQL
- JWT 认证

**前端**:
- Vue 3 Composition API
- Element Plus
- Pinia 状态管理
- sortablejs（拖拽）

**部署**:
- Docker Compose
- 腾讯云（2核2GB）

---

## 📝 备注

### 已推送 Commit
1. `4425cdb` - 数据模型扩展和表单修复
2. `f22a708` - 项目排序API和类型支持
3. `7c3e270` - Requirements API多负责人支持
4. `e933f2c` - Tasks API多负责人支持
5. `2989ac2` - 第一阶段完成文档
6. `eb83aa2` - 项目页面行内编辑
7. `9a9b6ed` - Docker构建优化
8. `9a9d331` - Alpine镜像源修复（失败）
9. `7533ec3` - 回退到官方源

### 当前状态
- ✅ 所有代码已推送到 GitHub
- 🔄 正在解决 Docker 构建问题
- ⏸️ 等待第一阶段部署成功后继续第二阶段

---

**文档创建时间**: 2024-01-02
**最后更新**: 2024-01-02
**当前分支**: master
**最新 commit**: 7533ec3
