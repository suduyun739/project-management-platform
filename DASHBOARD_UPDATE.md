# 数据看板功能说明

## 新增功能

### 1. 数据看板 (Dashboard)

已创建全新的数据可视化仪表盘页面,替代原有的简单看板视图。

#### 主要特性:

**统计卡片**
- 需求总数和完成率
- 任务总数和完成率
- 预估工时 vs 实际工时
- 整体进度百分比
- 点击卡片可跳转到对应的详情页面

**可视化图表 (基于 ECharts)**
1. **需求状态分布** - 饼图
   - 显示待处理、进行中、已完成、已拒绝的需求数量
   - 点击图表扇区可跳转到对应状态的需求列表

2. **任务状态分布** - 饼图
   - 显示待处理、进行中、测试中、已完成、已阻塞的任务数量
   - 点击图表扇区可跳转到对应状态的任务列表

3. **优先级分布** - 柱状图
   - 统计所有需求和任务的优先级分布
   - 低、中、高、紧急四个级别

4. **项目完成情况对比** - 分组柱状图
   - 对比各项目的需求总数、已完成需求、任务总数、已完成任务
   - 直观查看各项目进度

5. **工时统计** - 仪表盘
   - 显示工时完成率 (实际工时 / 预估工时)
   - 颜色分段: 绿色(0-30%)、蓝色(30-70%)、红色(70-100%)

**智能筛选**
- 按项目筛选: 选择特定项目查看其数据
- 日期范围筛选: 按时间段查看数据(预留功能)
- 筛选后所有图表和统计数据自动更新

**详细数据表格**
- 支持切换查看需求或任务的状态明细
- 显示每个状态的数量和占比
- 进度条可视化显示占比
- 点击数量可跳转到对应状态的详情页面

**响应式设计**
- 自适应不同屏幕尺寸
- 图表自动调整大小
- 移动端友好

## 导航结构变更

### 侧边栏菜单

新增"数据看板"菜单项,调整后的菜单顺序:
1. **数据看板** - 数据可视化总览
2. 项目 - 项目管理
3. 需求 - 需求管理
4. 任务 - 任务管理
5. **任务看板** - 原有的看板视图(保留)
6. 用户管理 - 仅管理员可见

### 项目侧边栏

项目详情页的快速操作菜单已更新:
- 查看需求
- 查看任务
- **数据看板** (原"看板视图")

## 技术实现

### 新增依赖

在 `frontend/package.json` 中添加:
```json
"echarts": "^5.4.3"
```

### 新增文件

- `frontend/src/views/Dashboard.vue` - 数据看板主页面
- `DASHBOARD_UPDATE.md` - 本说明文档

### 修改文件

- `frontend/package.json` - 添加 ECharts 依赖
- `frontend/src/router/index.ts` - 添加 Dashboard 路由
- `frontend/src/layouts/MainLayout.vue` - 添加"数据看板"菜单项
- `frontend/src/components/ProjectSidebar.vue` - 更新快速跳转菜单

## 部署步骤

### 1. 安装新依赖

```bash
cd frontend
npm install
```

### 2. 构建前端

```bash
npm run build
```

### 3. Docker 部署

```bash
# 在项目根目录
docker compose down
docker compose build frontend --no-cache
docker compose up -d
```

## 使用说明

### 访问数据看板

1. 登录后点击左侧菜单"数据看板"
2. 或在项目页面点击项目卡片的"更多操作" → "数据看板"

### 查看特定项目数据

1. 在数据看板页面上方选择项目
2. 所有图表和统计自动更新为该项目的数据
3. 点击图表或数字可跳转到详情页面,并自动应用项目筛选

### 查看详情

- **点击统计卡片**: 跳转到需求/任务列表页
- **点击饼图扇区**: 跳转到特定状态的需求/任务列表
- **点击表格中的数字**: 跳转到特定状态的详情页

### 数据刷新

- 点击右上角"刷新数据"按钮手动刷新
- 切换项目自动刷新

## 功能亮点

### 1. 数据联动

所有图表和统计数据来源一致,筛选条件联动更新,确保数据准确性。

### 2. 可点击跳转

图表和数字都支持点击跳转,快速查看详细信息:
- 点击"需求总数"卡片 → 跳转到需求页面
- 点击饼图"已完成" → 跳转到已完成需求列表
- 点击表格中的"5" → 跳转到对应状态的详情

### 3. 智能筛选记忆

从数据看板跳转到详情页时,自动携带筛选条件:
- 项目筛选
- 状态筛选
- 方便快速定位问题

### 4. 多维度统计

- 按状态统计(需求/任务)
- 按优先级统计
- 按项目对比
- 工时完成率

## 后续优化建议

### 1. 实时数据

- 添加 WebSocket 支持实时更新
- 数据变化自动刷新图表

### 2. 更多图表

- 趋势图: 展示需求/任务的时间趋势
- 燃尽图: 展示Sprint进度
- 热力图: 展示成员工作负载

### 3. 自定义看板

- 支持用户自定义图表布局
- 支持保存常用筛选条件
- 支持导出报表

### 4. 数据对比

- 不同时间段对比
- 不同项目对比
- 不同成员效率对比

### 5. 告警功能

- 延期任务提醒
- 阻塞任务提醒
- 工时超支提醒

## 常见问题

### Q1: 图表显示不完整

**解决**: 调整浏览器窗口大小,图表会自动重新渲染

### Q2: 数据不准确

**解决**: 点击右上角"刷新数据"按钮

### Q3: 点击图表无反应

**解决**:
- 确保已登录
- 检查是否有相应权限
- 普通用户只能看到分配给自己的数据

### Q4: 图表加载慢

**原因**: 数据量较大时,ECharts 渲染需要时间

**优化建议**:
- 使用项目筛选缩小数据范围
- 考虑后端分页加载

## 与原看板的区别

| 特性 | 原看板 (Kanban) | 新数据看板 (Dashboard) |
|------|----------------|----------------------|
| 用途 | 任务拖拽管理 | 数据统计分析 |
| 展示方式 | 卡片列 | 图表 + 卡片 |
| 交互方式 | 拖拽移动 | 点击跳转 |
| 数据范围 | 仅任务 | 需求 + 任务 |
| 筛选功能 | 项目/负责人 | 项目/日期 |
| 可视化 | 无 | 多种图表 |

**建议使用场景**:
- **数据看板**: 项目总览、进度汇报、数据分析
- **任务看板**: 日常任务管理、敏捷开发、状态跟踪

两个页面互补,保留原看板是为了满足不同场景需求。

## 截图说明

数据看板包含以下区域(从上到下):

1. **筛选栏**: 项目选择、日期范围、刷新按钮
2. **统计卡片**: 4个大卡片显示核心指标
3. **图表区**:
   - 第一行: 需求饼图 | 任务饼图 | 优先级柱状图
   - 第二行: 项目对比柱状图 | 工时仪表盘
4. **详细表格**: 状态明细数据

## 数据计算说明

### 完成率计算

**需求完成率** = (已完成需求数 / 需求总数) × 100%

**任务完成率** = (已完成任务数 / 任务总数) × 100%

**整体进度** = (需求完成率 + 任务完成率) / 2

### 工时完成率

**工时完成率** = (实际工时总计 / 预估工时总计) × 100%

- < 30%: 绿色 - 进度正常
- 30-70%: 蓝色 - 进度适中
- > 70%: 红色 - 接近或超出预期

## 权限说明

### 管理员 (ADMIN)

- 查看所有项目的数据
- 可切换查看不同项目
- 可查看所有成员的任务

### 普通成员 (MEMBER)

- 只能看到分配给自己的需求和任务
- 数据看板显示的是个人数据统计
- 项目筛选只显示参与的项目

## 性能优化

### 已实现

1. **按需加载**: 图表组件延迟初始化
2. **自动调整**: 窗口 resize 时图表自动适配
3. **数据缓存**: 避免重复请求

### 待优化

1. **虚拟滚动**: 大数据量表格优化
2. **Web Worker**: 数据计算放到后台线程
3. **CDN加速**: ECharts 使用 CDN 引入
4. **图片懒加载**: 图表截图功能

## 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

不支持 IE 浏览器。

## 移动端适配

- 图表自动缩放
- 响应式布局(通过 el-col 的 xs/sm/lg 属性)
- 触摸事件支持
- 建议横屏查看以获得最佳体验
